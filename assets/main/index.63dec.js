System.register("chunks:///_virtual/Drawing.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Grid.ts","./ShapeValidator.ts","./GameCamera.ts"],(function(t){var i,e,n,r,s,o,a,h,c,l,u,p,g,f,P,m,d,v,T,w,D,y;return{setters:[function(t){i=t.applyDecoratedDescriptor,e=t.inheritsLoose,n=t.createForOfIteratorHelperLoose,r=t.initializerDefineProperty,s=t.assertThisInitialized},function(t){o=t.cclegacy,a=t._decorator,h=t.Camera,c=t.Graphics,l=t.Node,u=t.Prefab,p=t.UITransform,g=t.sys,f=t.input,P=t.Input,m=t.instantiate,d=t.Vec2,v=t.Vec3,T=t.Component},function(t){w=t.Grid},function(t){D=t.ShapeValidator},function(t){y=t.GameCamera}],execute:function(){var E,b,M,C,S,O,U,L,_,A,x,V,G,H,z,N;o._RF.push({},"44ea89fcS5PXpVQMautyHBJ","Drawing",void 0);var F=a.ccclass,R=a.property;t("Drawing",(E=F("Drawing"),b=R(h),M=R(w),C=R(c),S=R(l),O=R(u),U=R(u),E((A=i((_=function(t){function i(){for(var i,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return i=t.call.apply(t,[this].concat(n))||this,r(i,"camera",A,s(i)),r(i,"grid",x,s(i)),r(i,"committedLinesGraphics",V,s(i)),r(i,"particlesParent",G,s(i)),r(i,"particlePrefab",H,s(i)),r(i,"commitedParticlePrefab",z,s(i)),r(i,"snapDistance",N,s(i)),i.graphics=null,i.uiTransform=null,i.gameCamera=null,i.points=[],i.isDrawing=!1,i.currentPosition=null,i.dragParticle=null,i.committedPaths=[],i}e(i,t);var o=i.prototype;return o.start=function(){this.graphics=this.getComponent(c),this.uiTransform=this.getComponent(p),this.gameCamera=this.camera.getComponent(y),g.isMobile?(f.on(P.EventType.TOUCH_START,this.onTouchStart,this),f.on(P.EventType.TOUCH_MOVE,this.onTouchMove,this),f.on(P.EventType.TOUCH_END,this.onTouchEnd,this),f.on(P.EventType.TOUCH_CANCEL,this.onTouchEnd,this)):(f.on(P.EventType.MOUSE_DOWN,this.onMouseDown,this),f.on(P.EventType.MOUSE_MOVE,this.onMouseMove,this),f.on(P.EventType.MOUSE_UP,this.onMouseUp,this))},o.onMouseDown=function(t){0===t.getButton()&&this.startDrawingAtScreenPos(t.getLocation())},o.onMouseMove=function(t){this.isDrawing&&this.updateDrawing(t.getLocation())},o.onMouseUp=function(t){0===t.getButton()&&this.finishDrawing()},o.onTouchStart=function(t){t.getAllTouches().length>=2||(this.gameCamera.isPinching?this.cancelDrawing():this.startDrawingAtScreenPos(t.getLocation()))},o.onTouchMove=function(t){this.isDrawing&&(this.gameCamera.isPinching?this.cancelDrawing():this.updateDrawing(t.getLocation()))},o.onTouchEnd=function(t){this.finishDrawing()},o.getLocalPosFromScreen=function(t){var i=this.camera.screenToWorld(t.toVec3());return this.uiTransform.convertToNodeSpaceAR(i).toVec2()},o.startDrawingAtScreenPos=function(t){var i=this.getLocalPosFromScreen(t),e=this.grid.getNearestPoint(i);e.distance<=this.snapDistance&&(this.points=[e.position]),this.isDrawing=!0,this.currentPosition=i,this.drawAll(),this.createDragParticle()},o.updateDrawing=function(t){var i=this.getLocalPosFromScreen(t),e=this.grid.getNearestPoint(i);e.distance<=this.snapDistance?(0!==this.points.length&&this.points[this.points.length-1].equals(e.position)||this.points.push(e.position),this.currentPosition=e.position):this.currentPosition=i,this.drawAll(),this.updateDragParticle()},o.finishDrawing=function(){if(this.isDrawing&&this.currentPosition){if(this.graphics.clear(),this.deleteDragParticle(),this.points.length>1){var t=this.getShape();D.validateShape(t)&&(this.committedPaths.push(this.points),this.drawCommittedPaths(),this.spawnParticlesOnPath(this.points))}this.isDrawing=!1,this.currentPosition=null,this.points=[]}},o.cancelDrawing=function(){this.graphics.clear(),this.deleteDragParticle(),this.isDrawing=!1,this.currentPosition=null,this.points=[]},o.drawAll=function(){if(this.graphics.clear(),this.points.length>1){this.graphics.moveTo(this.points[0].x,this.points[0].y);for(var t=1;t<this.points.length;t++)this.graphics.lineTo(this.points[t].x,this.points[t].y);this.graphics.stroke()}if(this.isDrawing&&this.currentPosition&&this.points.length>0){var i=this.points[this.points.length-1];this.graphics.moveTo(i.x,i.y),this.graphics.lineTo(this.currentPosition.x,this.currentPosition.y),this.graphics.stroke()}var e=1.18*this.graphics.lineWidth;this.currentPosition&&(this.graphics.circle(this.currentPosition.x,this.currentPosition.y,e),this.graphics.fill())},o.createDragParticle=function(){var t=m(this.particlePrefab);this.particlesParent.addChild(t),t.setPosition(this.currentPosition.toVec3()),this.dragParticle=t},o.updateDragParticle=function(){this.dragParticle.setPosition(this.currentPosition.toVec3())},o.deleteDragParticle=function(){this.dragParticle.destroy(),this.dragParticle=null},o.spawnParticlesOnPath=function(t){for(var i=0;i<t.length-1;i++){var e=t[i],n=t[i+1],r=new d(n.x-e.x,n.y-e.y),s=r.length();if(0!==s)for(var o=r.normalize(),a=0;a<=s;){var h=new d(e.x+o.x*a,e.y+o.y*a),c=m(this.commitedParticlePrefab);this.particlesParent.addChild(c),c.setPosition(new v(h.x,h.y,0)),a+=30}}},o.getShape=function(){for(var t,i=[],e=n(this.points);!(t=e()).done;){var r=t.value,s=this.grid.getPointAt(r);s&&i.push({row:s.row,col:s.col})}return i},o.drawCommittedPaths=function(){this.committedLinesGraphics.clear();for(var t,i=n(this.committedPaths);!(t=i()).done;){var e=t.value;if(!(e.length<2)){this.committedLinesGraphics.moveTo(e[0].x,e[0].y);for(var r=1;r<e.length;r++)this.committedLinesGraphics.lineTo(e[r].x,e[r].y);this.committedLinesGraphics.stroke()}}},o.onDestroy=function(){f.off(P.EventType.MOUSE_DOWN,this.onMouseDown,this),f.off(P.EventType.MOUSE_MOVE,this.onMouseMove,this),f.off(P.EventType.MOUSE_UP,this.onMouseUp,this),f.off(P.EventType.TOUCH_START,this.onTouchStart,this),f.off(P.EventType.TOUCH_MOVE,this.onTouchMove,this),f.off(P.EventType.TOUCH_END,this.onTouchEnd,this),f.off(P.EventType.TOUCH_CANCEL,this.onTouchEnd,this)},i}(T)).prototype,"camera",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=i(_.prototype,"grid",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=i(_.prototype,"committedLinesGraphics",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=i(_.prototype,"particlesParent",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=i(_.prototype,"particlePrefab",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=i(_.prototype,"commitedParticlePrefab",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=i(_.prototype,"snapDistance",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),L=_))||L));o._RF.pop()}}}));

System.register("chunks:///_virtual/GameCamera.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var i,o,e,n,s,h,a,r,c,u,l,p,m,f;return{setters:[function(t){i=t.applyDecoratedDescriptor,o=t.inheritsLoose,e=t.createClass,n=t.initializerDefineProperty,s=t.assertThisInitialized},function(t){h=t.cclegacy,a=t._decorator,r=t.Camera,c=t.sys,u=t.input,l=t.Input,p=t.Vec3,m=t.Vec2,f=t.Component}],execute:function(){var g,T,M,y,v;h._RF.push({},"0bf723SNp9FU4839l0H/bvg","GameCamera",void 0);var E=a.ccclass,S=a.property;t("GameCamera",E("GameCamera")((M=i((T=function(t){function i(){for(var i,o=arguments.length,e=new Array(o),h=0;h<o;h++)e[h]=arguments[h];return(i=t.call.apply(t,[this].concat(e))||this).camera=null,n(i,"minZoom",M,s(i)),n(i,"maxZoom",y,s(i)),n(i,"zoomSpeed",v,s(i)),i.initialZoom=0,i.isDragging=!1,i.lastMousePos=new p,i.pinchStartDist=0,i.pinchStartOrtho=0,i.isPinching=!1,i.lastPinchMidScreen=new m,i}o(i,t);var h=i.prototype;return h.start=function(){this.camera=this.getComponent(r),this.initialZoom=this.camera.orthoHeight,c.isMobile?(u.on(l.EventType.TOUCH_START,this.onTouchStart,this),u.on(l.EventType.TOUCH_MOVE,this.onTouchMove,this),u.on(l.EventType.TOUCH_END,this.onTouchEnd,this),u.on(l.EventType.TOUCH_CANCEL,this.onTouchEnd,this)):(u.on(l.EventType.MOUSE_WHEEL,this.onMouseWheel,this),u.on(l.EventType.MOUSE_DOWN,this.onMouseDown,this),u.on(l.EventType.MOUSE_MOVE,this.onMouseMove,this),u.on(l.EventType.MOUSE_UP,this.onMouseUp,this))},h.clampZoom=function(){this.camera.orthoHeight=Math.max(this.minZoom,Math.min(this.camera.orthoHeight,this.maxZoom))},h.onMouseWheel=function(t){var i=t.getScrollY();this.camera.orthoHeight-=i*this.zoomSpeed,this.clampZoom()},h.onMouseDown=function(t){if(1===t.getButton()){this.isDragging=!0;var i=t.getLocation();this.lastMousePos.set(i.x,i.y,0)}},h.onMouseUp=function(t){1===t.getButton()&&(this.isDragging=!1)},h.onMouseMove=function(t){if(this.isDragging){var i=t.getLocation(),o=i.x-this.lastMousePos.x,e=i.y-this.lastMousePos.y;this.lastMousePos.set(i.x,i.y,0);var n=new p(-o,-e,0);n.multiplyScalar(this.zoomFactor),this.camera.node.position=this.camera.node.position.add(n)}},h.getTwoTouchesPositions=function(t){var i=t.getAllTouches();return i.length<2?[]:[i[0].getLocation(),i[1].getLocation()]},h.distance=function(t,i){var o=t.x-i.x,e=t.y-i.y;return Math.sqrt(o*o+e*e)},h.onTouchStart=function(t){if(2===t.getAllTouches().length){var i=this.getTwoTouchesPositions(t),o=i[0],e=i[1];this.pinchStartDist=this.distance(o,e),this.pinchStartOrtho=this.camera.orthoHeight;var n=.5*(o.x+e.x),s=.5*(o.y+e.y);this.lastPinchMidScreen.set(n,s),this.isPinching=!0}},h.onTouchMove=function(t){if(this.isPinching){var i=this.getTwoTouchesPositions(t);if(!(i.length<2)){var o=this.distance(i[0],i[1]);if(!(this.pinchStartDist<=0)){var e=o/this.pinchStartDist;this.camera.orthoHeight=this.pinchStartOrtho/e,this.clampZoom();var n=.5*(i[0].x+i[1].x),s=.5*(i[0].y+i[1].y),h=n-this.lastPinchMidScreen.x,a=s-this.lastPinchMidScreen.y,r=new p(-h,-a,0);r.multiplyScalar(this.zoomFactor),this.camera.node.position=this.camera.node.position.add(r),this.lastPinchMidScreen.set(n,s)}}}},h.onTouchEnd=function(t){t.getAllTouches().length<2&&(this.isPinching=!1,this.pinchStartDist=0)},h.onDestroy=function(){u.off(l.EventType.MOUSE_WHEEL,this.onMouseWheel,this),u.off(l.EventType.MOUSE_DOWN,this.onMouseDown,this),u.off(l.EventType.MOUSE_MOVE,this.onMouseMove,this),u.off(l.EventType.MOUSE_UP,this.onMouseUp,this),u.off(l.EventType.TOUCH_START,this.onTouchStart,this),u.off(l.EventType.TOUCH_MOVE,this.onTouchMove,this),u.off(l.EventType.TOUCH_END,this.onTouchEnd,this),u.off(l.EventType.TOUCH_CANCEL,this.onTouchEnd,this)},e(i,[{key:"zoomFactor",get:function(){return this.camera.orthoHeight/this.initialZoom}}]),i}(f)).prototype,"minZoom",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 300}}),y=i(T.prototype,"maxZoom",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 800}}),v=i(T.prototype,"zoomSpeed",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.05}}),g=T))||g);h._RF.pop()}}}));

System.register("chunks:///_virtual/Grid.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var i,e,n,r,o,a,l,s,c,u,h,p,f;return{setters:[function(t){i=t.applyDecoratedDescriptor,e=t.inheritsLoose,n=t.createForOfIteratorHelperLoose,r=t.createClass,o=t.initializerDefineProperty,a=t.assertThisInitialized},function(t){l=t.cclegacy,s=t._decorator,c=t.JsonAsset,u=t.Graphics,h=t.Vec2,p=t.Color,f=t.Component}],execute:function(){var b,d,g,v,P,w,y,C,D,m,L,G;l._RF.push({},"65cb9BXI0hGHJsjt1Eapu1B","Grid",void 0);var R=s.ccclass,z=s.property;t("Grid",(b=R("Grid"),d=z(c),b((P=i((v=function(t){function i(){for(var i,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return i=t.call.apply(t,[this].concat(n))||this,o(i,"cellDistance",P,a(i)),o(i,"pointColor",w,a(i)),o(i,"pointRadius",y,a(i)),o(i,"interactablePointColor",C,a(i)),o(i,"interactablePointRadius",D,a(i)),o(i,"goalPointColor",m,a(i)),o(i,"goalPointRadius",L,a(i)),o(i,"levelDataAsset",G,a(i)),i.currentLevel=null,i.gridPoints=[],i.interactablePoints=[],i.graphics=null,i}e(i,t);var l=i.prototype;return l.start=function(){this.graphics=this.getComponent(u),this.loadLevel(1)},l.loadLevel=function(t){this.currentLevel=this.levelData.levels.find((function(i){return i.id===t})),this.generateGrid(),this.drawGrid()},l.drawGrid=function(){this.graphics.clear();for(var t,i=n(this.gridPoints);!(t=i()).done;)for(var e,r=t.value,o=n(r);!(e=o()).done;){var a=e.value;this.drawPoint(a)}},l.drawPoint=function(t){var i=this.pointColor,e=this.pointRadius;t.isGoal?(i=this.goalPointColor,e=this.goalPointRadius):t.isInteractable&&(i=this.interactablePointColor,e=this.interactablePointRadius),this.graphics.fillColor=i,this.graphics.circle(t.position.x,t.position.y,e),this.graphics.fill()},l.generateGrid=function(){var t=this;this.gridPoints=[],this.interactablePoints=[];for(var i=.5*((this.currentLevel.cols-1)*this.cellDistance),e=.5*((this.currentLevel.rows-1)*this.cellDistance),n=function(i,e){return t.currentLevel.interactablePoints.some((function(t){return t.row===i&&t.col===e}))},r=function(i,e){return t.currentLevel.goalPoints.some((function(t){return t.row===i&&t.col===e}))},o=0;o<this.currentLevel.rows;o++){this.gridPoints[o]=[];for(var a=0;a<this.currentLevel.cols;a++){var l=a*this.cellDistance-i,s=-o*this.cellDistance+e,c=new h(l,s),u=n(o,a),p={position:c,row:o,col:a,isInteractable:u,isGoal:r(o,a)};this.gridPoints[o][a]=p,u&&this.interactablePoints.push(p)}}},l.getNearestPoint=function(t){if(0===this.interactablePoints.length)return{position:null,distance:1/0};for(var i,e=null,r=1/0,o=n(this.interactablePoints);!(i=o()).done;){var a=i.value,l=h.distance(t,a.position);l<r&&(r=l,e=a)}return{position:e.position,distance:r}},l.getPointAt=function(t){if(0===this.interactablePoints.length)return null;for(var i,e=n(this.interactablePoints);!(i=e()).done;){var r=i.value;if(r.position.equals(t))return r}},l.getAllinteractablePoints=function(){return this.interactablePoints},r(i,[{key:"levelData",get:function(){return this.levelDataAsset.json}}]),i}(f)).prototype,"cellDistance",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),w=i(v.prototype,"pointColor",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new p(255,255,255,128)}}),y=i(v.prototype,"pointRadius",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),C=i(v.prototype,"interactablePointColor",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new p(0,255,0,128)}}),D=i(v.prototype,"interactablePointRadius",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 6}}),m=i(v.prototype,"goalPointColor",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new p(255,255,0,255)}}),L=i(v.prototype,"goalPointRadius",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 8}}),G=i(v.prototype,"levelDataAsset",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),g=v))||g));l._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./Drawing.ts","./GameCamera.ts","./Grid.ts","./ShapeValidator.ts"],(function(){return{setters:[null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/ShapeValidator.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var r,o;return{setters:[function(e){r=e.createForOfIteratorHelperLoose},function(e){o=e.cclegacy}],execute:function(){o._RF.push({},"8d42b5XSkJFh7ID29jQzEzZ","ShapeValidator",void 0);var t=[{isClosed:!0,name:"Triangle",shape:[{row:0,col:0},{row:10,col:0},{row:10,col:10},{row:0,col:0}]},{isClosed:!0,name:"Rhombus",shape:[{row:0,col:7},{row:7,col:0},{row:14,col:7},{row:7,col:14},{row:0,col:7}]},{isClosed:!1,name:"M-Shape",shape:[{row:29,col:0},{row:0,col:0},{row:10,col:10},{row:0,col:20},{row:29,col:20}]}];e("ShapeValidator",function(){function e(){}return e.validateShape=function(e){var r=this,o=this.normalizeShape(e);return console.log("Normalized shape:",o),t.some((function(e){var t=r.shapeMatches(o,e);return t&&console.log("Matched permitted shape "+e.name),t}))},e.normalizeShape=function(e){var r=Math.min.apply(Math,e.map((function(e){return e.row}))),o=Math.min.apply(Math,e.map((function(e){return e.col})));return e.map((function(e){return{row:e.row-r,col:e.col-o}}))},e.shapeMatches=function(e,r){var o=this.normalizeShape(r.shape);if(r.isClosed){for(var t=0,n=[1,-1];t<n.length;t++)for(var a=1===n[t]?e:[].concat(e).reverse(),c=0;c<a.length-1;c++){var l=this.rotateShape(a,c);if(this.sequenceMatchesStrict(l,o)&&this.allPointsOnEdgesStrict(l,o))return!0}return!1}var i=this.sequenceMatchesComplete(e,o),s=this.sequenceMatchesComplete(e,[].concat(o).reverse());return(i||s)&&this.allPointsOnPath(e,o)},e.sequenceMatchesStrict=function(e,o){for(var t,n,a=0,c=o.slice(0,-1),l=function(){var r=n.value,o=e.slice(a).findIndex((function(e){return e.row===r.row&&e.col===r.col}));if(-1===o)return{v:!1};a+=o+1},i=r(c);!(n=i()).done;)if(t=l())return t.v;return!0},e.sequenceMatchesComplete=function(e,o){for(var t,n,a=o,c=0,l=function(){var r=n.value,o=e.slice(c).findIndex((function(e){return e.row===r.row&&e.col===r.col}));if(-1===o)return{v:!1};c+=o+1},i=r(a);!(n=i()).done;)if(t=l())return t.v;return e[e.length-1].row===a[a.length-1].row&&e[e.length-1].col===a[a.length-1].col},e.allPointsOnEdgesStrict=function(e,r){for(var o=r.slice(0,-1),t=0,n=0;n<e.length-1;n++){for(var a=e[n],c=!1,l=t;l<o.length;l++){var i=o[l],s=o[(l+1)%o.length];if(this.pointOnSegment(a,i,s)){t=l,c=!0;break}}if(!c)return!1}return!0},e.allPointsOnPath=function(e,r){var o=this;return e.every((function(e){for(var t=0;t<r.length-1;t++)if(o.pointOnSegment(e,r[t],r[t+1]))return!0;return!1}))},e.pointOnSegment=function(e,r,o){if(0!==(e.col-r.col)*(o.row-r.row)-(e.row-r.row)*(o.col-r.col))return!1;var t=Math.min(r.col,o.col),n=Math.max(r.col,o.col),a=Math.min(r.row,o.row),c=Math.max(r.row,o.row);return e.col>=t&&e.col<=n&&e.row>=a&&e.row<=c},e.rotateShape=function(e,r){var o=e.slice(0,-1),t=[].concat(o.slice(r),o.slice(0,r));return t.push(t[0]),t},e}());o._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});